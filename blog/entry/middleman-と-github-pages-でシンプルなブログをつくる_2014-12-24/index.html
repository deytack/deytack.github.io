<html>
<head>
<title>ktakad.github.io</title>
<link href="/stylesheets/index.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div class='pgWrapper'>
<header class='globalHeader'>
<h1><a href="/">www.sou-sou.net</a></h1>
</header>

<nav class='globalNav'>
<ul>
<li><a href="/">Index</a></li>
<li><a href="/blog/">Blog</a></li>
<li><a href="/ktakad/">Profile</a></li>
</ul>
</nav>

<div class='pgBody'>
<section class='blog'>
<header>
<h2>Blog</h2>
</header>
<div class='blogBody'>
<article>
<header>
<h3>Middleman と Github Pages でシンプルなブログをつくる</h3>
</header>
<div class='articleBody'><h4 id="section">はじめに</h4>

<p><a href="http://middlemanapp.com/jp/">Middleman</a> でビルドした記事を
<a href="https://pages.github.com">Github Pages</a> にアップする形式のブログを作ります。</p>

<p>こんな人に向いていると思う：</p>

<ul>
  <li>デザインは自分でゼロから作りたい</li>
  <li>CMS導入の段階で自分が作ったものではないテンプレートがたくさんある状況はいやだ</li>
  <li>訪問者に見せる部分は自分ですべて把握したい</li>
  <li>開発とビルドされた状態とを分離したい。ついでに AltJS やその他便利なテンプレート言語を使いたい</li>
  <li>ミニマムな機能だけあればいい</li>
  <li>コメント、フィードバック、その他動的に変化する要素はいらない</li>
  <li>何か機能が必要だったら、それに応じてサービスのウィジェットや提供されている API
を組み込んで対応したい</li>
  <li>レスポンスはできるだけ早くしたい</li>
  <li>お気に入りのエディタで記事を書きたい</li>
  <li>Word Press 等の著名 CMS や、各種ブログサービスには便利な UI や管理画面が付いているが、
メモ感覚で使うよりガッツリ「書く」事を要求されているようでつらい</li>
</ul>

<h4 id="middleman--github-pages-">Middleman と Github Pages について</h4>

<p>Middleman は、Ruby ベースで書かれた静的サイトジェネレータです。
ローカルでページをビルドするところに特徴があります。
ページ数 2 桁くらいの規模の Web サイトを、統一されたデザインで作りたい場合に最も効力を発揮しそうです。</p>

<p>Github Pages は、Github に username.github.io というリポジトリを作ることで、
そのリポジトリ内のファイルを Web サイトとして閲覧可能な仕組みです。
PHP や Ruby 等によって動的にページを生成することはできません。</p>

<p>Github Pages では、Octopress といった Middleman (Middleman-blog)
に似た仕組みがプッシュされていますが、Middleman は見た目に関わる部分をほぼ
自分で書かなければいけない分、デザインの自由度が高いと思ったので採用しました。</p>

<h4 id="section-1">手順</h4>

<ul>
  <li>必要なソフトウェアをインストール</li>
  <li>テンプレートを middleman-blog にして init</li>
  <li>middleman init をしたフォルダ配下に Github Pages のリポジトリを clone
し、ビルドフォルダにする</li>
  <li>middleman-blog の設定をみなおす</li>
  <li>記事を書く</li>
  <li>デザインをする</li>
  <li>Github Pages に公開する</li>
  <li>その他参考程度に</li>
  <li>自分の構成と手順</li>
  <li>詰まったところ</li>
</ul>

<h4 id="section-2">必要なソフトウェアをインストール</h4>

<p>以下のソフトウェア、またはアカウントが必要です。</p>

<ul>
  <li>Middleman, middleman-blog</li>
  <li>付随して Ruby や Bundler 等のインストール・更新が必要になるかも。ここでは解説しません。</li>
  <li>Github のアカウント、必要に応じて Git のコマンドラインツール等</li>
</ul>

<h4 id="middleman-blog--init">テンプレートを middleman-blog にして init</h4>

<p>以下のコマンドを実行することで、middleman-blog のスケルトンが作成できます。</p>

<p><code>
middleman init MY_BLOG_PROJECT --template=blog
</code></p>

<p>2014年12月現在のスケルトンの構成は以下のとおり。</p>

<p><code>
MY_BLOG_PROJECT
|- source/
| |- hogehoge
</code></p>

<p>この状態で middleman コマンドを実行し、 http://localhost:4567/
にアクセスすることにより現在のサイトの見た目を確認できます。その他、コンフィグ等については
http://localhost:4567/__middleman/　にアクセスすることにより確認できます。
特にサイトマップが一覧できるのが便利。</p>

<h4 id="middleman-init--github-pages--clone-">middleman init したフォルダ配下に github pages のリポジトリを clone し、ビルドフォルダにする</h4>

<p>Github に username.github.io という名前のリポジトリを作り、プロジェクトフォルダ上で
clone します。リポジトリ名のフォルダが出来るので、このフォルダを <code>build</code> にリネームします。</p>

<h4 id="middleman-blog-">middleman-blog の設定をみなおす</h4>

<p>middleman-blog のデフォルトの設定では、記事ファイルもレイアウトファイルもプロジェクトフォルダの
直下に置くことになるので、管理しやすいように各々フォルダに分けたい。</p>

<p>また、これは好みですが、blog は blog というディレクトリに入っていて欲しいので以下のように設定を書きます。</p>

<h4 id="section-3">記事を書く</h4>

<p>middleman-blog では、以下のコマンドを実行することにより、記事ファイルが生成できます。</p>

<p>タイトルはファイル名と記事ファイル内の yaml ヘッダの 2 箇所に書かれるため、
あとから「やっぱりタイトル変える」というのが面倒なのでちゃんと考えましょう。</p>

<p>ビルドしてみる</p>

<h4 id="section-4">デザインをする</h4>

<p>必要に応じて Sass や CoffeeScript 等を用いてデザインをします。
テンプレート(layout)の概念については公式ページや他の人の記事を当たるのが良いです。</p>

<h4 id="github-pages-">Github Pages に公開する</h4>

<p>Terminal で build フォルダに移動し、自分の Github Pages のリポジトリに Push します。</p>

<p>初回の Push 直後はリポジトリの中身が反映されず、見られるようになるには 30 分ほど掛かります。</p>

<h4 id="section-5">その他参考程度に</h4>

<h5 id="section-6">自分の構成と手順</h5>

<h6 id="url-">URL 構成</h6>

<p>middleman のデフォルトの設定では、</p>

<h6 id="section-7">ドラフトフォルダ</h6>

<p>あ、この記事長くなりそうだな、という予感がした時は、予め用意したドラフトフォルダに
記事を置いて、そこで書いています。ドラフトは見られると良くないので、下記のように設定を
config.rb に記述することにより、ビルド対象から外しています。</p>

<p><code>
command
</code></p>

<h6 id="git">ビルドフォルダ以外のファイルのGit管理</h6>

<p>自分は、 Middleman のプロジェクトフォルダをまるごと BitBucket
のプライベートリポジトリにプッシュしています。
そして、このような構成にする事により git コマンド等を何回も打つ必要があるので、
コマンドをまとめてバッチファイルにしています。図を書くとこんな感じ。</p>

<p>図</p>

<p>バッチの中身はこんな感じ。</p>

<p><code>
command
</code></p>

<h5 id="section-8">詰まったところ</h5>

<h6 id="timezone-">Time.zone の指定方法</h6>

<p>デフォルトで "UTC" と書いてあるので、"UTC+9" 的な書き方かと思ったけど違った。
"Tokyo" だった。</p>

<h6 id="taghtmlerb--calenderhtmlerb-">tag.html.erb と calender.html.erb の移動ができない</h6>

<p>middleman blog のオプションでパスを指定したにもかかわらず、この
2 ファイルを移動するとエラーになる。</p>
</div>
</article>
</div>
</section>
</div>
</div>
</body>
</html>
